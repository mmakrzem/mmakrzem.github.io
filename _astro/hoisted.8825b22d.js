import{h as g,g as c,o as v,s as k,G as p,a as l,b,f as h,c as o,d as w,i as E,C as f}from"./PayPal.11b9b7ea.js";const e={loginAndPurchaseEl:void 0},V=g(h(),"getPurchasedVideosAsync"),q=g(h(),"getVmkPriceAsync"),I=g(h(),"purchaseVmkAsync"),S=g(h(),"handleOrderAsync");function O(){e.loginAndPurchaseEl=c({query:"#loginAndPurchase"}),v(l(),async i=>{const a=i!==null,P=await B();o({isVisible:!1,query:"#loading",root:e.loginAndPurchaseEl}),o({isVisible:!1,query:"#loading2",root:e.loginAndPurchaseEl}),o({isVisible:!a,query:"button.signIn",root:e.loginAndPurchaseEl}),o({isVisible:a,query:"button.signOut",root:e.loginAndPurchaseEl}),o({isVisible:!a,query:"img.signIn",root:e.loginAndPurchaseEl}),o({isVisible:a&&P,query:"p.thanks",root:e.loginAndPurchaseEl});const y=a&&!P;if(o({isVisible:y,query:"#loadingPayPal",root:e.loginAndPurchaseEl}),o({isVisible:y,query:"div.purchase",root:e.loginAndPurchaseEl}),y)try{const d=await w(),u=e.loginAndPurchaseEl.dataset.vmkSection;if(u===void 0)throw new Error("vmkSection = undefined");const r=await q({vmkSection:u});if(r.data.price){const n=c({query:"div.price .normal",root:e.loginAndPurchaseEl});if(n.innerHTML=`$${r.data.price.toFixed(2)}`,r.data.salePrice&&r.data.salePrice>0&&r.data.salePrice<r.data.price){n.classList.add("onSale");const m=c({query:"div.price .sale",root:e.loginAndPurchaseEl});m.innerHTML=`$${r.data.salePrice.toFixed(2)}`,m.style.display="inline"}}const A=d.Buttons&&d.Buttons({createOrder:async()=>{const n=await I({isSandbox:E(),vmkSection:u});return(n===void 0||n.data===void 0)&&alert(`Error creating order.  Please contact ${f} for help`),n.data.id},onApprove:async(n,m)=>{(await S({isSandbox:E(),orderId:n.orderID,vmkSection:u})).data.isPurchased&&setTimeout(()=>window.location.reload(),2e3)},onError:n=>{alert(`Error processing order. Try again, or please contact ${f} for help`),console.error(n)},onInit:()=>{o({isVisible:!1,query:"#loadingPayPal",root:e.loginAndPurchaseEl})}});if(A===void 0)throw new Error("paypal.Buttons is undefined?");A.render("#payPalButton")}catch(d){console.error("failed to load the PayPal JS SDK script",d)}L(a&&P)}),c({query:"button.signIn",root:e.loginAndPurchaseEl}).addEventListener("click",()=>k(l(),new p)),c({query:"button.signOut",root:e.loginAndPurchaseEl}).addEventListener("click",()=>b(l())),window.unlockVideo=T}async function B(){const s=e.loginAndPurchaseEl.dataset.vmkSection;if(s===void 0||l().currentUser===null)return!1;try{const t=await V({vmkSection:s}),i=t.data.vmk!==void 0&&Object.keys(t.data.vmk).length>0;return i&&(e.vmk=t.data.vmk),i}catch(t){return console.error(t),!1}}function L(s){const t=document.querySelectorAll("div.card img.locked");for(const i of t)i instanceof HTMLImageElement&&(i.src=`/images/marekKnows/${s?"watch":"locked"}.png`)}function T(s){if(l().currentUser===null||e.vmk===void 0||e.vmk[s]===void 0){e.loginAndPurchaseEl.scrollIntoView({behavior:"smooth"});return}window.playYouTubeVideo(e.vmk[s])}const $=document.querySelectorAll("div.card img.locked");$.length>0&&O();
