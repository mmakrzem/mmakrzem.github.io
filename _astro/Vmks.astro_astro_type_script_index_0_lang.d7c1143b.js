import{h as g,g as c,o as v,s as k,G as p,a as l,b,f as h,c as o,d as w,i as E,C as f}from"./PayPal.8156f27f.js";const e={loginAndPurchaseEl:void 0},V=g(h(),"getPurchasedVideosAsync"),q=g(h(),"getVmkPriceAsync"),I=g(h(),"purchaseVmkAsync"),S=g(h(),"handleOrderAsync");function O(){e.loginAndPurchaseEl=c({query:"#loginAndPurchase"}),v(l(),async i=>{const a=i!==null,P=await B();o({root:e.loginAndPurchaseEl,query:"#loading",isVisible:!1}),o({root:e.loginAndPurchaseEl,query:"#loading2",isVisible:!1}),o({root:e.loginAndPurchaseEl,query:"button.signIn",isVisible:!a}),o({root:e.loginAndPurchaseEl,query:"button.signOut",isVisible:a}),o({root:e.loginAndPurchaseEl,query:"img.signIn",isVisible:!a}),o({root:e.loginAndPurchaseEl,query:"p.thanks",isVisible:a&&P});const y=a&&!P;if(o({root:e.loginAndPurchaseEl,query:"#loadingPayPal",isVisible:y}),o({root:e.loginAndPurchaseEl,query:"div.purchase",isVisible:y}),y)try{const d=await w(),u=e.loginAndPurchaseEl.dataset.vmkSection;if(u===void 0)throw new Error("vmkSection = undefined");const r=await q({vmkSection:u});if(r.data.price){const n=c({root:e.loginAndPurchaseEl,query:"div.price .normal"});if(n.innerHTML=`$${r.data.price.toFixed(2)}`,r.data.salePrice&&r.data.salePrice>0&&r.data.salePrice<r.data.price){n.classList.add("onSale");const m=c({root:e.loginAndPurchaseEl,query:"div.price .sale"});m.innerHTML=`$${r.data.salePrice.toFixed(2)}`,m.style.display="inline"}}const A=d.Buttons&&d.Buttons({onInit:()=>{o({root:e.loginAndPurchaseEl,query:"#loadingPayPal",isVisible:!1})},createOrder:async()=>{const n=await I({isSandbox:E(),vmkSection:u});return(n===void 0||n.data===void 0)&&alert(`Error creating order.  Please contact ${f} for help`),n.data.id},onApprove:async(n,m)=>{(await S({isSandbox:E(),orderId:n.orderID,vmkSection:u})).data.isPurchased&&setTimeout(()=>window.location.reload(),2e3)},onError:n=>{alert(`Error processing order. Try again, or please contact ${f} for help`),console.error(n)}});if(A===void 0)throw new Error("paypal.Buttons is undefined?");A.render("#payPalButton")}catch(d){console.error("failed to load the PayPal JS SDK script",d)}L(a&&P)}),c({root:e.loginAndPurchaseEl,query:"button.signIn"}).addEventListener("click",()=>k(l(),new p)),c({root:e.loginAndPurchaseEl,query:"button.signOut"}).addEventListener("click",()=>b(l())),window.unlockVideo=T}async function B(){const s=e.loginAndPurchaseEl.dataset.vmkSection;if(s===void 0||l().currentUser===null)return!1;try{const t=await V({vmkSection:s}),i=t.data.vmk!==void 0&&Object.keys(t.data.vmk).length>0;return i&&(e.vmk=t.data.vmk),i}catch(t){return console.error(t),!1}}function L(s){const t=document.querySelectorAll("div.card img.locked");for(const i of t)i instanceof HTMLImageElement&&(i.src=`/images/marekKnows/${s?"watch":"locked"}.png`)}function T(s){if(l().currentUser===null||e.vmk===void 0||e.vmk[s]===void 0){e.loginAndPurchaseEl.scrollIntoView({behavior:"smooth"});return}window.playYouTubeVideo(e.vmk[s])}const $=document.querySelectorAll("div.card img.locked");$.length>0&&O();
